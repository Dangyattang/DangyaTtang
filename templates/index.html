<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë‹¹ì‹ ì€ ì•¼ì‹ì´ ë•¡ê¸´ë‹¤</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.3/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <!-- í°íŠ¸ í—¤ë” -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Gasoek+One&display=swap"
      rel="stylesheet"
    />

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>

    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      crossorigin="anonymous"
    ></script>
    <style>
      #orderregi {
        position: fixed;
        bottom: 60px;
        right: 60px;
      }
      .challange {
        margin: 10px auto 30px auto;
        width: 800px;
        text-align: center;

        border: 3px solid black;
        border-radius: 5px;

        padding: 5px;
      }
      .gasoek-one-regular {
        font-family: "Gasoek One", sans-serif;
        font-weight: 400;
        font-style: normal;
        position: relative;
        top: -5px;
      }

      .container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        padding: 10px;
      }

      .wrap {
        width: 800px;
        margin: 0 auto; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
      }

      .icon svg {
        width: 50px;
        height: 50px;
        margin: 10px;
      }
      .btngroup {
        display: flex;
        flex-wrap: nowrap; /* ë²„íŠ¼ë“¤ì´ í•œ ì¤„ì— ë§ì§€ ì•Šìœ¼ë©´ ìë™ìœ¼ë¡œ ì¤„ë°”ê¿ˆ */
        width: 800px; /* ë„ˆë¹„ë¥¼ 800pxë¡œ ì„¤ì • */
        margin: 0 auto; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
        justify-content: space-evenly; /* ë²„íŠ¼ë“¤ ê°„ì— ê· ë“±í•œ ê°„ê²©ì„ ì„¤ì • */
      }
      .btngroup button {
        width: 100px;
      }

      .max-w-7xl {
        max-width: 800px;
      }
    </style>
    <script>
      const API_BASE_URL = "http://127.0.0.1:5000"; // API ê²½ë¡œ (5000 í¬íŠ¸)

      $(document).ready(function () {
        const modal = $("#crud-modal");
        const buttonContainer = $("#selected-buttons");
        const ordersContainer = $("#OrdersBox");

        // í˜ì´ì§€ ë¡œë”© ì‹œ íŒ€ ì£¼ë¬¸ ì „ì²´ ì¡°íšŒ
        showOrders();

        var socket = io.connect("http://127.0.0.1:5000/"); // ì›¹ì†Œì¼“ ì—°ê²°
        socket.on("connect", function () {
          console.log("âœ… WebSocket ì—°ê²° ì„±ê³µ!");
        });

        socket.on("disconnect", function () {
          console.log("âš ï¸ WebSocket ì—°ê²° ëŠê¹€!");
        });
        // âœ… ì£¼ë¬¸ ìƒíƒœ ë³€ê²½ ì´ë²¤íŠ¸ ìˆ˜ì‹ 
        socket.on("order_update", function (data) {
          console.log("ğŸ”” ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ìˆ˜ì‹ :", data); // ğŸ”¥ ë¡œê·¸ ì¶”ê°€

          let orderId = data.order_id;
          let newStatus = data.status;

          console.log(`ğŸ“¢ ì£¼ë¬¸ ID: ${orderId}, ìƒíƒœ: ${newStatus}`); // ğŸ”¥ ë””ë²„ê¹… ë¡œê·¸

          let orderCard = document.getElementById(orderId);
          if (!orderCard) {
            console.error(`âŒ ì£¼ë¬¸ ID ${orderId}ì— í•´ë‹¹í•˜ëŠ” ì¹´ë“œê°€ ì—†ìŒ.`);
            return;
          }

          if (newStatus === "failed") {
            console.log(`ğŸš¨ ì£¼ë¬¸ ${orderId} ëª¨ì§‘ ë§ˆê° ì´ë²¤íŠ¸ ê°ì§€`);
            orderCard.classList.add("bg-gray-300", "text-gray-500");
            orderCard.innerHTML += `<div class="text-red-500 font-bold">ëª¨ì§‘ ë§ˆê°</div>`;
            alert(`ğŸš¨ ì£¼ë¬¸ ${orderId} ëª¨ì§‘ ë§ˆê°ë¨`);
          } else if (newStatus === "confirmed") {
            console.log(`âœ… ì£¼ë¬¸ ${orderId} í™•ì • ì´ë²¤íŠ¸ ê°ì§€`);
            orderCard.classList.add("bg-green-300", "text-green-800");
            orderCard.innerHTML += `<div class="text-green-500 font-bold">ì£¼ë¬¸ í™•ì •!</div>`;
            alert(`âœ… ì£¼ë¬¸ ${orderId} í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`);
          }
        });
        // ëª¨ë‹¬ ì—´ê¸°
        $("[data-modal-toggle='crud-modal']").on("click", function () {
          modal.toggleClass("hidden flex");
        });

        // ëª¨ë‹¬ ë‹«ê¸°
        modal
          .find("button[data-modal-toggle='crud-modal']")
          .on("click", function () {
            modal.addClass("hidden").removeClass("flex");
          });

        // íŒ€ ì£¼ë¬¸ ë“±ë¡
        $("#orderRegisterButton").on("click", function (e) {
          e.preventDefault();
          const kakaoUrl = $("#kakaoURL").val();
          const limitTime = $("#limitTime").val();
          const maxParticipants = $("#maxPerson").val();
          const selectedButtons = buttonContainer.find("button");
          const foodCategory = selectedButtons
            .map(function () {
              return $(this).attr("data-value");
            })
            .get();
          const detailMenu = $("#detailMenu").val();

          if (maxParticipants > 10) {
            alert("10ëª… ì´ìƒì€ ì¶”ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ âŒ");
            return;
          }

          $.ajax({
            type: "POST",
            url: `${API_BASE_URL}/order`,
            contentType: "application/json",
            data: JSON.stringify({
              kakaoUrl_give: kakaoUrl,
              limitTime_give: limitTime,
              maxPerson_give: maxParticipants,
              foodCategory_give: foodCategory,
              detailMenu_give: detailMenu,
            }),
            success: function (data) {
              alert(data.message);

              modal.addClass("hidden").removeClass("flex");
              showOrders();
            },
            error: function (error) {
              console.error("ì—ëŸ¬ ë°œìƒ:", error);
            },
          });
        });

        // ìŒì‹ ì¹´í…Œê³ ë¦¬ ì„ íƒ
        const selectedFoods = $("#selected-buttons"); // ì„ íƒëœ ìŒì‹ ë²„íŠ¼ í‘œì‹œ ì˜ì—­
        const foodCategorySelect = $("#food-category"); // ìŒì‹ ì¹´í…Œê³ ë¦¬ select ë°•ìŠ¤
        let selectedItems = []; // ì„ íƒëœ ìŒì‹ ë¦¬ìŠ¤íŠ¸

        // ìŒì‹ ì¹´í…Œê³ ë¦¬ ì„ íƒ ì‹œ ë²„íŠ¼ ìƒì„±
        foodCategorySelect.on("change", function () {
          const selectedValue = $(this).val();

          // ì´ë¯¸ ì„ íƒëœ ê°’ì¸ì§€ í™•ì¸ & ìµœëŒ€ 3ê°œ ì œí•œ
          if (selectedItems.includes(selectedValue)) {
            alert("ì´ë¯¸ ì„ íƒëœ ì¹´í…Œê³ ë¦¬ì…ë‹ˆë‹¤.");
            return;
          }
          if (selectedItems.length >= 3) {
            alert("ìµœëŒ€ 3ê°œê¹Œì§€ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            return;
          }

          selectedItems.push(selectedValue);

          // ë²„íŠ¼ ìƒì„±
          const button = $(
            `<button class="px-3 py-1 bg-red-500 text-white text-sm rounded-lg hover:bg-red-700 transition" data-value="${selectedValue}">
          ${selectedValue} âœ–
        </button>`
          );

          // ì‚­ì œ ê¸°ëŠ¥ ì¶”ê°€
          button.on("click", function () {
            const valueToRemove = $(this).attr("data-value");
            selectedItems = selectedItems.filter(
              (item) => item !== valueToRemove
            );
            $(this).remove();
          });

          selectedFoods.append(button);
        });

        // ì¹´í…Œê³ ë¦¬ë³„ ì¡°íšŒ ìš”ì²­
        let selectedCategory = null; // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ì¶”ì  ë³€ìˆ˜

        $(".getFoodCategoryButton").on("click", function () {
          const foodCategory = $(this).val();

          // ì´ë¯¸ ì„ íƒëœ ì¹´í…Œê³ ë¦¬ë¥¼ ë‹¤ì‹œ ëˆ„ë¥´ë©´ ì „ì²´ ì¡°íšŒë¡œ ë³€ê²½
          if (selectedCategory === foodCategory) {
            selectedCategory = null;
            showOrders(); // ì „ì²´ ì£¼ë¬¸ ì¡°íšŒ
            $(".getFoodCategoryButton")
              .removeClass("bg-gray-900 text-white")
              .addClass("bg-transparent text-gray-900");
          } else {
            selectedCategory = foodCategory;
            filterOrdersByCategory(foodCategory);

            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            $(".getFoodCategoryButton")
              .removeClass("bg-gray-900 text-white")
              .addClass("bg-transparent text-gray-900");
            $(this)
              .removeClass("bg-transparent text-gray-900")
              .addClass("bg-gray-900 text-white");
          }
        });

        function filterOrdersByCategory(category) {
          $.ajax({
            type: "GET",
            url: `${API_BASE_URL}/orders/category?category=${category}`,
            dataType: "json",
            success: function (data) {
              $("#OrdersBox").empty();

              if (!Array.isArray(data) || data.length === 0) {
                console.warn(`"${category}" ì¹´í…Œê³ ë¦¬ì—ì„œ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.`);
                return;
              }

              let loggedInUserId = "{{ user_id }}"; // ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ID ê°€ì ¸ì˜¤ê¸°

              for (let order of data) {
                let isParticipating =
                  order.participants?.some(
                    participant => participant === loggedInUserId
                  ) || false; // âœ… ë¹ˆ ë°°ì—´ì¼ ê²½ìš°ì—ë„ ê¸°ë³¸ê°’ false

                makeOrder(
                  order._id,
                  order.food_category,
                  order.menu_details,
                  order.expires_at,
                  order.participants,
                  order.max_participants,
                  isParticipating
                );
              }
            },
            error: function (error) {
              console.error(`"${category}" ì¹´í…Œê³ ë¦¬ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:`, error);
              alert("ì¹´í…Œê³ ë¦¬ ì„ íƒ ì˜¤ë¥˜ ë°œìƒ");
            },
          });
        }

        // ì£¼ë¬¸ ì¹´ë“œ ìƒì„± í•¨ìˆ˜
        function makeOrder(
          orderid,
          category,
          menudetail,
          expires_at,
          participations,
          maxPerson,
          isParticipating
        ) {
          const currentTime = new Date();
          const expiresTime = new Date(expires_at);
          const timeDiff = Math.floor((expiresTime - currentTime) / 60000);
          let timeDisplay =
            timeDiff > 0 ? `â³ ë‚¨ì€ ì‹œê°„ : ${timeDiff}ë¶„ ì „` : "ëª¨ì§‘ ì¢…ë£Œ";

          let borderClass = isParticipating
            ? "border-red-500 shadow-md"
            : "border-gray-200 dark:border-gray-700";

          let tempHtml = `
          <div
            id="${orderid}"
            class="group bg-gray-50 dark:bg-gray-800 rounded-md overflow-hidden border ${borderClass} hover:shadow-lg transition-transform transform hover:scale-105"
          >
            <div class="p-5">
              <h3 class="text-lg font-semibold text-red-500 dark:text-red-400 group-hover:text-red-600 transition">
                ${category}
              </h3>

              <div class="flex justify-between items-center mt-3">
                <span class="text-sm text-gray-600 dark:text-gray-300">
                  ${timeDisplay}
                </span>
                <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">
                  ğŸ‘¥ ${participations.length}/${maxPerson}
                </span>
              </div>

              <div class="mt-2">
                <span class="text-xs text-gray-500 dark:text-gray-400">
                  ${menudetail}
                </span>
              </div>

              <div class="mt-4 flex justify-end">
                <button class="apply-button px-4 py-2 bg-red-500 text-white font-semibold rounded-full hover:bg-red-600 transition-all"
                  data-order-id="${orderid}">
                  ${isParticipating ? "ì°¸ì—¬ì¤‘ âœ…" : "ì°¸ê°€"}
                </button>
              </div>
            </div>
          </div>
      `;

          $("#OrdersBox").append(tempHtml);
        }

        // íŒ€ ì°¸ê°€ ì‹ ì²­ request
        $(document).on("click", ".apply-button", function () {
          let orderId = $(this).data("order-id"); // ë°ì´í„° ì†ì„±ì—ì„œ ê°€ì ¸ì˜¤ê¸°
          console.log(`ğŸ›  ì‹ ì²­í•˜ëŠ” ì£¼ë¬¸ ID: ${orderId}`); // ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€

          if (!orderId) {
            alert("ì£¼ë¬¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
          }

          let confirmApply = confirm("í•´ë‹¹ ì£¼ë¬¸ì— ì°¸ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
          if (!confirmApply) return;

          $.ajax({
            url: `/order/${orderId}`, // ì˜¬ë°”ë¥¸ order IDê°€ ì „ì†¡ë˜ëŠ”ì§€ í™•ì¸
            type: "PUT",
            contentType: "application/json",
            success: function (response) {
              alert(response.message);
              showOrders(); // ì£¼ë¬¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            },
            error: function (error) {
              console.error("ğŸš¨ ì‹ ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
              alert(
                error.responseJSON?.message ||
                  "ì°¸ê°€ ì‹ ì²­ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
              );
            },
          });
        });

        function showOrders() {
          $.ajax({
            type: "GET",
            url: `${API_BASE_URL}/orders`,
            dataType: "json",
            success: function (data) {
              console.log(data, "ì „ì²´ ì¡°íšŒ ì„±ê³µ");

              // ê¸°ì¡´ ì¹´ë“œ ì‚­ì œ í›„ ìƒˆë¡œ ì¶”ê°€
              ordersContainer.empty();

              let loggedInUserId = "{{ user_id }}"; // ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ë¡œê·¸ì¸í•œ ìœ ì € ID
              let activeOrderId = null;

              for (let order of data) {
                // ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ì°¸ì—¬í•œ ì£¼ë¬¸ì¸ì§€ í™•ì¸
                let isParticipating =
                  order.participants.includes(loggedInUserId);

                // ì°¸ì—¬ ì¤‘ì¸ ì£¼ë¬¸ì´ ìˆìœ¼ë©´ í•´ë‹¹ ID ì €ì¥
                if (isParticipating) {
                  activeOrderId = order._id;
                }

                makeOrder(
                  order._id,
                  order.food_category,
                  order.menu_details,
                  order.expires_at,
                  order.participants,
                  order.max_participants,
                  isParticipating
                );
              }

              // ë§Œì•½ ì‚¬ìš©ìê°€ ì°¸ì—¬ ì¤‘ì¸ ì£¼ë¬¸ì´ ìˆìœ¼ë©´ ë‹¤ë¥¸ ì°¸ê°€ ë²„íŠ¼ ë¹„í™œì„±í™”
              if (activeOrderId) {
                $(".apply-button").each(function () {
                  if ($(this).data("order-id") !== activeOrderId) {
                    $(this)
                      .prop("disabled", true)
                      .text("ì°¸ê°€ ë¶ˆê°€ âŒ")
                      .addClass("opacity-50");
                  }
                });
              }
            },
            error: function (error) {
              console.error("ì—ëŸ¬ ë°œìƒ:", error);
            },
          });
        }
      });
    </script>
  </head>
  <body>
    <div class="container text-center">
      <div style="text-align: left">
        <a
          href="/"
          class="block text-center cursor-pointer hover:opacity-80 w-fit mx-auto"
        >
          <div
            class="mb-6 inline-flex justify-center text-5xl font-bold leading-none"
          >
            <span class="gasoek-one-regular text-red-500">ë‹¹</span>
            <span class="gasoek-one-regular">ì‹ ì€&nbsp;</span>
            <span class="gasoek-one-regular text-red-500">ì•¼</span>
            <span class="gasoek-one-regular">ì‹ì´&nbsp;</span>
            <span class="gasoek-one-regular text-red-500">ë•¡</span>
            <span class="gasoek-one-regular">ê¸´ë‹¤</span>
          </div>
        </a>
      </div>

      <!-- ì˜¤ë¥¸ìª½ ì •ë ¬ -->
      <div style="text-align: right">
        <span
          id="user"
          style="font-family: Arial, Helvetica, sans-serif; font-size: x-large"
        >
          {% if username %}
          <div class="text-center mb-4">
            <a href="{{ url_for('personal_page') }}"
              >ì•ˆë…•í•˜ì„¸ìš”, {{ username }}ë‹˜!</a
            >
            <a
              href="{{ url_for('logout') }}"
              class="text-red-500 hover:underline"
              >ë¡œê·¸ì•„ì›ƒ</a
            >
          </div>
          {% else %}
          <div class="text-center mb-4">
            <a
              href="{{ url_for('login_page') }}"
              class="text-blue-500 hover:underline"
              >ë¡œê·¸ì¸</a
            >
            |
            <a
              href="{{ url_for('register_page') }}"
              class="text-blue-500 hover:underline"
              >íšŒì›ê°€ì…</a
            >
          </div>
          {% endif %}
        </span>
      </div>
    </div>
    <div class="wrap">
      <!-- âœ… ì´ë‹¬ì˜ ì•¼ì‹ì™• (ë…ë¦½ëœ ì„¹ì…˜) -->
      <div class="text-center text-lg font-bold mb-6">
        {% if top_delivery_user %}
        <p class="text-2xl">
          ğŸ† ì´ë‹¬ì˜ ì•¼ì‹ì™•
          <span class="text-red-500">'{{ top_delivery_user }}'</span>ë‹˜! ğŸ‰
        </p>
        {% else %}
        <p class="text-gray-600">
          ì•„ì§ ì•¼ì‹ì™•ì´ ì—†ìŠµë‹ˆë‹¤! ì²« ë²ˆì§¸ ì•¼ì‹ì™•ì´ ë˜ì–´ë³´ì„¸ìš”!
        </p>
        {% endif %}
      </div>

      <!-- âœ… ìŒì‹ ì¹´í…Œê³ ë¦¬ í•„í„° (ë³„ë„ ì„¹ì…˜) -->
      <div
        class="btngroup flex items-center justify-center rounded-md shadow-xs"
        role="group"
        style="width: 800px; margin: 0 auto"
      >
        <button
          type="button"
          value="ì¹˜í‚¨"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 rounded-s-lg hover:bg-gray-900 hover:text-white"
        >
          ì¹˜í‚¨
        </button>
        <button
          type="button"
          value="í”¼ì"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 hover:bg-gray-900 hover:text-white"
        >
          í”¼ì
        </button>
        <button
          type="button"
          value="ì¤‘ì‹"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 hover:bg-gray-900 hover:text-white"
        >
          ì¤‘ì‹
        </button>
        <button
          type="button"
          value="ì¼ì‹"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 hover:bg-gray-900 hover:text-white"
        >
          ì¼ì‹
        </button>
        <button
          type="button"
          value="ì–‘ì‹"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 hover:bg-gray-900 hover:text-white"
        >
          ì–‘ì‹
        </button>
        <button
          type="button"
          value="ë¶„ì‹"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 hover:bg-gray-900 hover:text-white"
        >
          ë¶„ì‹
        </button>
        <button
          type="button"
          value="íƒ•,ì°Œê°œ"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 hover:bg-gray-900 hover:text-white"
        >
          íƒ•,ì°Œê°œ
        </button>
        <button
          type="button"
          value="ê³ ê¸°"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 hover:bg-gray-900 hover:text-white"
        >
          ê³ ê¸°
        </button>
        <button
          type="button"
          value="ë””ì €íŠ¸"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 rounded-e-lg hover:bg-gray-900 hover:text-white"
        >
          ë””ì €íŠ¸
        </button>
      </div>

      <br />
      <span class="gasoek-one-regular text-center text-3xl">íŒ€ ì£¼ë¬¸</span>
    </div>

    <!-- Minimal Blog Cards Grid -->
    <div class="max-w-7xl w-full mx-auto p-4" style="max-width: 800px">
      <!-- Cards Grid Container -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="OrdersBox">
        <!-- Card 1 -->
        <div
          id="orderid1"
          class="group bg-gray-50 dark:bg-gray-800 rounded-md overflow-hidden border border-gray-200 dark:border-gray-700 hover:border-red-500 hover:shadow-lg transition-transform transform hover:scale-105"
        >
          <div class="p-5">
            <!-- ìŒì‹ ì¹´í…Œê³ ë¦¬ -->
            <h3
              class="text-lg font-semibold text-red-500 dark:text-red-400 group-hover:text-red-600 transition"
            >
              ì¹˜í‚¨ + í”¼ì
            </h3>

            <!-- ëª¨ì§‘ ì •ë³´ -->
            <div class="flex justify-between items-center mt-3">
              <span class="text-sm text-gray-600 dark:text-gray-300">
                â³ ë‚¨ì€ ì‹œê°„ : 3ë¶„
              </span>
              <span
                class="text-sm font-semibold text-gray-700 dark:text-gray-300"
              >
                ğŸ‘¥ 2 / 5
              </span>
            </div>

            <!-- ìƒì„¸ ë©”ë‰´ -->
            <div class="mt-2">
              <span class="text-xs text-gray-500 dark:text-gray-400">
                #í—ˆë‹ˆì½¤ë³´ #í•˜ì™€ì´ì•ˆí”¼ì
              </span>
            </div>

            <!-- ì°¸ê°€ ë²„íŠ¼ -->
            <div class="mt-4 flex justify-end">
              <button
                class="px-4 py-2 bg-red-500 text-white font-semibold rounded-full hover:bg-red-600 transition-all"
              >
                ì°¸ê°€
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div style="text-align: right" id="orderregi">
      <button
        data-modal-target="crud-modal"
        data-modal-toggle="crud-modal"
        class="px-6 py-2.5 border-2 border-red-500 text-red-500 rounded-lg hover:bg-red-50 transition-colors"
      >
        ì£¼ë¬¸ë“±ë¡
      </button>
    </div>

    <!-- ëª¨ë‹¬ ë°°ê²½ (ì •ì¤‘ì•™ì— ìœ„ì¹˜í•˜ë„ë¡ ìˆ˜ì •) -->
    <div
      id="crud-modal"
      tabindex="-1"
      aria-hidden="true"
      class="hidden fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center"
    >
      <!-- ëª¨ë‹¬ ì»¨í…ì¸  -->
      <div
        class="relative bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 w-full max-w-2xl absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"
      >
        <!-- ëª¨ë‹¬ í—¤ë” -->
        <div
          class="flex items-center justify-between pb-4 border-b border-gray-300 dark:border-gray-600"
        >
          <h3 class="text-xl font-bold text-red-500">íŒ€ ì£¼ë¬¸ ì—´ê¸°</h3>
          <button
            type="button"
            class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
            data-modal-toggle="crud-modal"
          >
            âœ–
          </button>
        </div>

        <!-- ëª¨ë‹¬ ë³¸ë¬¸ -->
        <form class="pt-4">
          <div class="grid gap-4 mb-4 grid-cols-2">
            <!-- ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ… URL -->
            <div class="col-span-2">
              <label
                for="kakaoURL"
                class="block text-sm font-medium text-gray-900 dark:text-white"
                >ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…ë°© URL</label
              >
              <input
                type="text"
                id="kakaoURL"
                class="w-full p-3 mt-1 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                placeholder="https://open.kakao.com/..."
                required
              />
            </div>

            <!-- ì œí•œì‹œê°„ -->
            <div class="col-span-1">
              <label
                for="limitTime"
                class="block text-sm font-medium text-gray-900 dark:text-white"
                >ì œí•œì‹œê°„</label
              >
              <select
                id="limitTime"
                class="w-full p-3 mt-1 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
              >
                <option selected>ì‹œê°„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                <option value="10">10ë¶„</option>
                <option value="20">20ë¶„</option>
                <option value="30">30ë¶„</option>
              </select>
            </div>

            <!-- ìµœëŒ€ ì¸ì›ìˆ˜ -->
            <div class="col-span-1">
              <label
                for="person"
                class="block text-sm font-medium text-gray-900 dark:text-white"
                >ì¸ì›ìˆ˜</label
              >
              <input
                type="number"
                id="maxPerson"
                class="w-full p-3 mt-1 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                placeholder="ìµœëŒ€ ì¸ì›"
                required
              />
            </div>

            <!-- ìŒì‹ ì¹´í…Œê³ ë¦¬ -->
            <div class="col-span-2">
              <label
                for="food-category"
                class="block text-sm font-medium text-gray-900 dark:text-white"
                >ìŒì‹ ì¹´í…Œê³ ë¦¬</label
              >
              <select
                id="food-category"
                class="w-full p-3 mt-1 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
              >
                <option selected disabled>ìŒì‹ ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                <option value="ì¹˜í‚¨">ì¹˜í‚¨</option>
                <option value="í”¼ì">í”¼ì</option>
                <option value="ì¤‘ì‹">ì¤‘ì‹</option>
                <option value="ì¼ì‹">ì¼ì‹</option>
                <option value="ì–‘ì‹">ì–‘ì‹</option>
                <option value="ë¶„ì‹">ë¶„ì‹</option>
                <option value="íƒ•,ì°Œê°œ">íƒ•,ì°Œê°œ</option>
                <option value="ê³ ê¸°">ê³ ê¸°</option>
                <option value="ë””ì €íŠ¸">ë””ì €íŠ¸</option>
              </select>

              <!-- ì„ íƒëœ ìŒì‹ í‘œì‹œ -->
              <div
                id="selected-buttons"
                class="flex flex-wrap gap-2 mt-3"
              ></div>
            </div>

            <!-- ìƒì„¸ë©”ë‰´ -->
            <div class="col-span-2">
              <label
                for="detailMenu"
                class="block text-sm font-medium text-gray-900 dark:text-white"
                >ìƒì„¸ë©”ë‰´</label
              >
              <input
                type="text"
                id="detailMenu"
                class="w-full p-3 mt-1 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                placeholder="ë‚´ê°€ ë¨¹ì„ ë©”ë‰´ ì…ë ¥"
                required
              />
            </div>
          </div>

          <!-- íŒ€ ì£¼ë¬¸ ê°œì„¤ ë²„íŠ¼ -->
          <div class="flex justify-end">
            <button
              type="submit"
              id="orderRegisterButton"
              class="px-5 py-2.5 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition-all"
            >
              íŒ€ ì£¼ë¬¸ ê°œì„¤
            </button>
          </div>
        </form>
      </div>
    </div>
  </body>
</html>

<script>
  async function checkTokenStatus() {
    const cookies = document.cookie.split("; ").reduce((acc, cookie) => {
      const [name, value] = cookie.split("=");
      acc[name] = value;
      return acc;
    }, {});

    const now = Date.now();

    // âœ… Access Token ë§Œë£Œ ì„ë°• ì‹œ ìë™ ê°±ì‹ 
    if (cookies["access_token"]) {
      const tokenPayload = JSON.parse(
        atob(cookies["access_token"].split(".")[1])
      );
      const exp = tokenPayload.exp * 1000;

      if (exp - now < 5000) {
        // ğŸ”¥ 5ì´ˆ ì´í•˜ë¡œ ë‚¨ìœ¼ë©´ ìë™ ê°±ì‹ 
        console.log("[DEBUG] Access Token ë§Œë£Œ ì„ë°•, Refresh Token ìš”ì²­");
        await fetch("/refresh-token", {
          method: "POST",
          credentials: "include",
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.access_token) {
              console.log("[DEBUG] ìƒˆë¡œìš´ Access Token ë°œê¸‰ ì™„ë£Œ");
              document.cookie = `access_token=${data.access_token}; path=/; HttpOnly`;
            } else {
              console.error("[ERROR] Access Token ê°±ì‹  ì‹¤íŒ¨");
            }
          })
          .catch((error) =>
            console.error("[ERROR] Refresh Token ìš”ì²­ ì‹¤íŒ¨:", error)
          );
      }
    }

    // âœ… Refresh Token ë§Œë£Œ ì‹œ ìë™ ë¡œê·¸ì•„ì›ƒ
    if (cookies["refresh_token"]) {
      const refreshPayload = JSON.parse(
        atob(cookies["refresh_token"].split(".")[1])
      );
      const refreshExp = refreshPayload.exp * 1000;

      if (refreshExp < now) {
        console.log("[DEBUG] Refresh Token ë§Œë£Œë¨, ìë™ ë¡œê·¸ì•„ì›ƒ ì‹¤í–‰");
        await fetch("/logout", { method: "GET", credentials: "include" }).then(
          () => (window.location.href = "/login")
        );
      }
    }
  }

  // ğŸ”¥ 10ì´ˆë§ˆë‹¤ Access Token & Refresh Token ìƒíƒœ í™•ì¸
  setInterval(checkTokenStatus, 10000);
</script>
