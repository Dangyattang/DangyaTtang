<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë‹¹ì‹ ì€ ì•¼ì‹ì´ ë•¡ê¸´ë‹¤</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.3/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <!-- í°íŠ¸ í—¤ë” -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Gasoek+One&display=swap"
      rel="stylesheet"
    />

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      crossorigin="anonymous"
    ></script>
    <style>
      #orderregi {
        position: fixed;
        bottom: 60px;
        right: 60px;
      }
      .challange {
        margin: 10px auto 30px auto;
        width: 800px;
        text-align: center;

        border: 3px solid black;
        border-radius: 5px;

        padding: 5px;
      }
      .gasoek-one-regular {
        font-family: "Gasoek One", sans-serif;
        font-weight: 400;
        font-style: normal;
        position: relative;
        top: -5px;
      }

      .container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        padding: 10px;
      }

      .wrap {
        width: 800px;
        margin: 0 auto; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
      }

      .icon svg {
        width: 50px;
        height: 50px;
        margin: 10px;
      }
      .btngroup {
        display: flex;
        flex-wrap: nowrap; /* ë²„íŠ¼ë“¤ì´ í•œ ì¤„ì— ë§ì§€ ì•Šìœ¼ë©´ ìë™ìœ¼ë¡œ ì¤„ë°”ê¿ˆ */
        width: 800px; /* ë„ˆë¹„ë¥¼ 800pxë¡œ ì„¤ì • */
        margin: 0 auto; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
        justify-content: space-evenly; /* ë²„íŠ¼ë“¤ ê°„ì— ê· ë“±í•œ ê°„ê²©ì„ ì„¤ì • */
      }
      .btngroup button {
        width: 100px;
      }

      .max-w-7xl {
        max-width: 800px;
      }
    </style>
    <script>
      const API_BASE_URL = "http://127.0.0.1:5000"; // API ê²½ë¡œ (5000 í¬íŠ¸)

      $(document).ready(function () {
        const modal = $("#crud-modal");
        const buttonContainer = $("#selected-buttons");
        const ordersContainer = $("#OrdersBox");

        // í˜ì´ì§€ ë¡œë”© ì‹œ íŒ€ ì£¼ë¬¸ ì „ì²´ ì¡°íšŒ
        showOrders();

        // ëª¨ë‹¬ ì—´ê¸°
        $("[data-modal-toggle='crud-modal']").on("click", function () {
          modal.toggleClass("hidden flex");
        });

        // ëª¨ë‹¬ ë‹«ê¸°
        modal
          .find("button[data-modal-toggle='crud-modal']")
          .on("click", function () {
            modal.addClass("hidden").removeClass("flex");
          });

        // íŒ€ ì£¼ë¬¸ ë“±ë¡
        $("#orderRegisterButton").on("click", function (e) {
          e.preventDefault();
          const kakaoUrl = $("#kakaoURL").val();
          const limitTime = $("#limitTime").val();
          const maxParticipants = $("#maxPerson").val();
          const selectedButtons = buttonContainer.find("button");
          const foodCategory = selectedButtons
            .map(function () {
              return $(this).attr("data-value");
            })
            .get();
          const detailMenu = $("#detailMenu").val();

          if (maxParticipants > 10) {
            alert("10ëª… ì´ìƒì€ ì¶”ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ âŒ");
            return;
          }

          $.ajax({
            type: "POST",
            url: `${API_BASE_URL}/order`,
            contentType: "application/json",
            data: JSON.stringify({
              kakaoUrl_give: kakaoUrl,
              limitTime_give: limitTime,
              maxPerson_give: maxParticipants,
              foodCategory_give: foodCategory,
              detailMenu_give: detailMenu,
            }),
            success: function (data) {
              alert(data.message);

              modal.addClass("hidden").removeClass("flex");
              showOrders();
            },
            error: function (error) {
              console.error("ì—ëŸ¬ ë°œìƒ:", error);
            },
          });
        });

        // ìŒì‹ ì¹´í…Œê³ ë¦¬ ì„ íƒ
        $("#food-category").on("change", function () {
          const selectedValue = $(this).val();

          // ìµœëŒ€ 3ê°œê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥
          if (buttonContainer.find("button[data-value]").length >= 3) {
            alert("ìµœëŒ€ 3ê°œê¹Œì§€ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            $(this).val("");
            return;
          }

          // ì´ë¯¸ ì„ íƒëœ ê°’ì¸ì§€ í™•ì¸
          if (
            selectedValue &&
            buttonContainer.find(`[data-value="${selectedValue}"]`).length === 0
          ) {
            const button = $("<button>")
              .attr("data-value", selectedValue)
              .addClass(
                "flex items-center px-3 py-1 bg-blue-500 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition"
              )
              .text(selectedValue);

            const closeIcon = $(`
          <span class="cursor-pointer">
            <svg class="w-3 h-3 ml-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
            </svg>
          </span>
        `);

            closeIcon.on("click", function (event) {
              event.stopPropagation();
              button.remove();
            });

            button.append(closeIcon);
            buttonContainer.append(button);
          }

          $(this).val("");
        });

        // ì¹´í…Œê³ ë¦¬ë³„ ì¡°íšŒ ìš”ì²­
        $(".getFoodCategoryButton").on("click", function () {
          const foodCategory = $(this).val();
          console.log(`ì„ íƒëœ ì¹´í…Œê³ ë¦¬: ${foodCategory}`);

          $.ajax({
            type: "GET",
            url: `${API_BASE_URL}/orders/category?category=${foodCategory}`,
            dataType: "json",
            success: function (data) {
              ordersContainer.empty();
              if (!data.length) {
                alert("ì¡°íšŒëœ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤");
                return;
              }
              for (let order of data) {
                makeOrder(
                  order._id,
                  order.food_category,
                  order.menu_details,
                  order.expires_at,
                  order.participants,
                  order.max_participants
                );
              }
            },
            error: function (error) {
              console.error(
                `"${foodCategory}" ì¹´í…Œê³ ë¦¬ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:`,
                error
              );
              alert("ì¹´í…Œê³ ë¦¬ ì„ íƒ ì˜¤ë¥˜ ë°œìƒ");
            },
          });
        });

        // ì£¼ë¬¸ ì¹´ë“œ ìƒì„± í•¨ìˆ˜
        function makeOrder(
          orderid,
          menucatagory,
          menudetail,
          expires_at,
          participations,
          maxPerson
        ) {
          const currentTime = new Date();
          const expiresTime = new Date(expires_at); // ISO 8601 í˜•ì‹ ë³€í™˜
          const timeDiff = Math.floor((expiresTime - currentTime) / 60000); // ë°€ë¦¬ì´ˆ -> ë¶„ ë³€í™˜
          let timeDisplay =
            timeDiff > 0 ? `íŒ€ ì£¼ë¬¸ ëª¨ì§‘ ë§ˆê° ${timeDiff}ë¶„ ì „` : "ëª¨ì§‘ ì¢…ë£Œ";

          let tempHtml = `
            <div id="${orderid}" class="group bg-white dark:bg-[#1E2028] rounded-md overflow-hidden border border-gray-100 dark:border-gray-800 hover:border-indigo-500 dark:hover:border-indigo-500 transition-colors">
              <div class="p-4">
                <h3 class="text-lg font-medium text-black dark:text-white mt-2 group-hover:text-indigo-500 transition-colors line-clamp-2">${menucatagory}</h3>
                <div class="flex flex-wrap items-center gap-4 mt-4">
                  <span class="text-xs text-gray-500 dark:text-gray-400">${timeDisplay}</span>
                  <span class="text-xs text-gray-500 dark:text-gray-400"> í•„ìš”ì¸ì› : ${participations.length}/${maxPerson}</span>
                </div>
                <div class="mt-1">
                  <span class="text-xs text-gray-500 dark:text-gray-400">${menudetail}</span>
                </div>
                <div class="mt-2 flex justify-end">
                  <button class="px-4 py-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors">ì°¸ê°€</button>
                </div>
              </div>
            </div>`;
          $("#OrdersBox").append(tempHtml);
        }

        function showOrders() {
          $.ajax({
            type: "GET",
            url: `${API_BASE_URL}/orders`,
            dataType: "json",
            success: function (data) {
              console.log(data, "ì „ì²´ ì¡°íšŒ ì„±ê³µ");

              // ê¸°ì¡´ ì¹´ë“œ ì‚­ì œ í›„ ìƒˆë¡œ ì¶”ê°€
              ordersContainer.empty();

              for (let order of data) {
                makeOrder(
                  order._id,
                  order.food_category,
                  order.menu_details,
                  order.expires_at,
                  order.participants,
                  order.max_participants
                );
              }
            },
            error: function (error) {
              console.error("ì—ëŸ¬ ë°œìƒ:", error);
            },
          });
        }
      });
    </script>
  </head>
  <body>
    <div class="container">
      <div style="text-align: left">
        <span
          class="gasoek-one-regular"
          style="color: red; font-size: 40px; display: inline"
          >ë‹¹</span
        >
        <span
          class="gasoek-one-regular"
          style="font-size: 40px; display: inline"
          >ì‹ ì€
        </span>
        <span
          class="gasoek-one-regular"
          style="color: red; font-size: 40px; display: inline"
          >ì•¼</span
        >
        <span
          class="gasoek-one-regular"
          style="font-size: 40px; display: inline"
          >ì‹ì´
        </span>
        <span
          class="gasoek-one-regular"
          style="color: red; font-size: 40px; display: inline"
          >ë–™</span
        >
        <span
          class="gasoek-one-regular"
          style="font-size: 40px; display: inline"
          >ê¸´ë‹¤</span
        >
      </div>

      <!-- ì˜¤ë¥¸ìª½ ì •ë ¬ -->
      <span
        id="user"
        style="font-family: Arial, Helvetica, sans-serif; font-size: x-large"
      >
        {% if username %}
        <div class="text-center mb-4">
          <a href="{{ url_for('personal') }}">ì•ˆë…•í•˜ì„¸ìš”, {{ username }}ë‹˜!</a>
          <a href="{{ url_for('logout') }}" class="text-red-500 hover:underline"
            >ë¡œê·¸ì•„ì›ƒ</a
          >
        </div>
        {% else %}
        <div class="text-center mb-4">
          <a
            href="{{ url_for('login_page') }}"
            class="text-blue-500 hover:underline"
            >ë¡œê·¸ì¸</a
          >
          |
          <a
            href="{{ url_for('register_page') }}"
            class="text-blue-500 hover:underline"
            >íšŒì›ê°€ì…</a
          >
        </div>
        {% endif %}
      </span>
    </div>
    <div class="wrap">
      <!-- âœ… ì´ë‹¬ì˜ ì•¼ì‹ì™• (ë…ë¦½ëœ ì„¹ì…˜) -->
      <div class="text-center text-lg font-bold mb-6">
        {% if top_delivery_user %}
        <p class="text-2xl">
          ğŸ† ì´ë‹¬ì˜ ì•¼ì‹ì™•
          <span class="text-red-500">'{{ top_delivery_user }}'</span>ë‹˜! ğŸ‰
        </p>
        {% else %}
        <p class="text-gray-600">
          ì•„ì§ ì•¼ì‹ì™•ì´ ì—†ìŠµë‹ˆë‹¤! ì²« ë²ˆì§¸ ì•¼ì‹ì™•ì´ ë˜ì–´ë³´ì„¸ìš”!
        </p>
        {% endif %}
      </div>

      <!-- âœ… ìŒì‹ ì¹´í…Œê³ ë¦¬ í•„í„° (ë³„ë„ ì„¹ì…˜) -->
      <div
        class="btngroup flex items-center justify-center rounded-md shadow-xs"
        role="group"
        style="width: 800px; margin: 0 auto"
      >
        <button
          type="button"
          value="ì¹˜í‚¨"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 rounded-s-lg hover:bg-gray-900 hover:text-white"
        >
          ì¹˜í‚¨
        </button>
        <button
          type="button"
          value="í”¼ì"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 hover:bg-gray-900 hover:text-white"
        >
          í”¼ì
        </button>
        <button
          type="button"
          value="ì¤‘ì‹"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 hover:bg-gray-900 hover:text-white"
        >
          ì¤‘ì‹
        </button>
        <button
          type="button"
          value="ì¼ì‹"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 hover:bg-gray-900 hover:text-white"
        >
          ì¼ì‹
        </button>
        <button
          type="button"
          value="ì–‘ì‹"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 hover:bg-gray-900 hover:text-white"
        >
          ì–‘ì‹
        </button>
        <button
          type="button"
          value="ë¶„ì‹"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 hover:bg-gray-900 hover:text-white"
        >
          ë¶„ì‹
        </button>
        <button
          type="button"
          value="íƒ•,ì°Œê°œ"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 hover:bg-gray-900 hover:text-white"
        >
          íƒ•,ì°Œê°œ
        </button>
        <button
          type="button"
          value="ê³ ê¸°"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 hover:bg-gray-900 hover:text-white"
        >
          ê³ ê¸°
        </button>
        <button
          type="button"
          value="ë””ì €íŠ¸"
          class="getFoodCategoryButton px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 rounded-e-lg hover:bg-gray-900 hover:text-white"
        >
          ë””ì €íŠ¸
        </button>
      </div>

      <br />
      <span class="gasoek-one-regular text-center text-3xl">íŒ€ ì£¼ë¬¸</span>
    </div>

    <!-- Minimal Blog Cards Grid -->
    <div class="max-w-7xl w-full mx-auto p-4" style="max-width: 800px">
      <!-- Cards Grid Container -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="OrdersBox">
        <!-- Card 1 -->
        <div
          id="orderid1"
          class="group bg-white dark:bg-[#1E2028] rounded-md overflow-hidden border border-gray-100 dark:border-gray-800 hover:border-indigo-500 dark:hover:border-indigo-500 transition-colors"
        >
          <div class="p-4">
            <!-- Title -->
            <h3
              class="text-lg font-medium text-black dark:text-white mt-2 group-hover:text-indigo-500 transition-colors line-clamp-2"
            >
              ì¹˜í‚¨ + í”¼ì
            </h3>

            <!-- Meta Information -->
            <div class="flex flex-wrap items-center gap-4 mt-4">
              <span class="text-xs text-gray-500 dark:text-gray-400">
                ë‚¨ì€ì‹œê°„ : 3ë¶„</span
              >
              <span class="text-xs text-gray-500 dark:text-gray-400">
                í•„ìš”ì¸ì› : 2/5</span
              >
            </div>
            <div class="mt-1">
              <span class="text-xs text-gray-500 dark:text-gray-400"
                >#í—ˆë‹ˆì½¤ë³´ #í•˜ì™€ì´ì•ˆí”¼ì</span
              >
            </div>
            <div class="mt-2 flex justify-end">
              <button
                class="px-4 py-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors"
              >
                ì°¸ê°€
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div style="text-align: right" id="orderregi">
      <button
        data-modal-target="crud-modal"
        data-modal-toggle="crud-modal"
        class="px-6 py-2.5 border-2 border-red-500 text-red-500 rounded-lg hover:bg-red-50 transition-colors"
      >
        ì£¼ë¬¸ë“±ë¡
      </button>
    </div>

    <!-- Main modal -->
    <div
      id="crud-modal"
      tabindex="-1"
      aria-hidden="true"
      class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full"
    >
      <div class="relative p-4 w-full max-w-2xl max-h-full">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow-sm dark:bg-gray-700">
          <!-- Modal header -->
          <div
            class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600 border-gray-200"
          >
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
              íŒ€ì£¼ë¬¸ ì—´ê¸°
            </h3>
            <button
              type="button"
              class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
              data-modal-toggle="crud-modal"
            >
              <svg
                class="w-3 h-3"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 14 14"
              >
                <path
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
                />
              </svg>
              <span class="sr-only">Close modal</span>
            </button>
          </div>
          <!-- Modal body -->
          <form class="p-4 md:p-5">
            <div class="grid gap-4 mb-4 grid-cols-2">
              <div class="col-span-2">
                <label
                  for="kakaoURL"
                  class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                  >ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…ë°© URL</label
                >
                <input
                  type="text"
                  id="kakaoURL"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                  placeholder="URL"
                  required=""
                />
              </div>
              <div class="col-span-2 sm:col-span-1">
                <label
                  for="category"
                  class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                  >ì œí•œì‹œê°„</label
                >
                <select
                  id="limitTime"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                >
                  <option selected="">ì‹œê°„ì„ ê³ ë¥´ì‹œì˜¤</option>
                  <option value="10">10</option>
                  <option value="20">20</option>
                  <option value="30">30</option>
                </select>
              </div>

              <div class="col-span-2 sm:col-span-1">
                <label
                  for="maxPerson"
                  class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                  >ì¸ì›ìˆ˜</label
                >
                <input
                  type="number"
                  name="maxPerson"
                  id="maxPerson"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                  placeholder="0"
                  required=""
                  min="2"
                  max="10"
                />
              </div>

              <div class="col-span-2 sm:col-span-1">
                <label
                  for="foodcat"
                  class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                  >ìŒì‹ ì¹´í…Œê³ ë¦¬</label
                >
                <select
                  id="food-category"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                >
                  <option selected="">ìŒì‹ ì¹´í…Œê³ ë¦¬</option>
                  <option value="ì¹˜í‚¨">ì¹˜í‚¨</option>
                  <option value="í”¼ì">í”¼ì</option>
                  <option value="ì¤‘ì‹">ì¤‘ì‹</option>
                  <option value="ì¼ì‹">ì¼ì‹</option>
                  <option value="ì–‘ì‹">ì–‘ì‹</option>
                  <option value="ë¶„ì‹">ë¶„ì‹</option>
                  <option value="íƒ•,ì°Œê°œ">íƒ•,ì°Œê°œ</option>
                  <option value="ê³ ê¸°">ê³ ê¸°</option>
                  <option value="ë””ì €íŠ¸">ë””ì €íŠ¸</option>
                </select>
              </div>
              <div class="col-span-2 sm:col-span-1" id="selectedFood">
                <label
                  for="filterMenu"
                  class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                  >ì„ íƒëœ ë©”ë‰´</label
                >
                <div
                  id="selected-buttons"
                  class="flex flex-wrap gap-2 mt-3"
                ></div>
              </div>
            </div>
            <div class="col-span-2 sm:col-span-1 mb-4">
              <label
                for="detailMenu"
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >ìƒì„¸ë©”ë‰´</label
              >
              <input
                type="text"
                id="detailMenu"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                placeholder="ë‚´ê°€ ë¨¹ì„ ë©”ë‰´ ì…ë ¥"
                required=""
              />
            </div>
            <button
              type="button"
              id="orderRegisterButton"
              class="text-white inline-flex items-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
            >
              <svg
                class="me-1 -ms-1 w-5 h-5"
                fill="currentColor"
                viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill-rule="evenodd"
                  d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
                  clip-rule="evenodd"
                ></path>
              </svg>
              íŒ€ ì£¼ë¬¸ ê°œì„¤
            </button>
          </form>
        </div>
      </div>
    </div>
  </body>
</html>

<script>
  async function checkTokenStatus() {
    const cookies = document.cookie.split("; ").reduce((acc, cookie) => {
      const [name, value] = cookie.split("=");
      acc[name] = value;
      return acc;
    }, {});

    const now = Date.now();

    // âœ… Access Token ë§Œë£Œ ì„ë°• ì‹œ ìë™ ê°±ì‹ 
    if (cookies["access_token"]) {
      const tokenPayload = JSON.parse(
        atob(cookies["access_token"].split(".")[1])
      );
      const exp = tokenPayload.exp * 1000;

      if (exp - now < 5000) {
        // ğŸ”¥ 5ì´ˆ ì´í•˜ë¡œ ë‚¨ìœ¼ë©´ ìë™ ê°±ì‹ 
        console.log("[DEBUG] Access Token ë§Œë£Œ ì„ë°•, Refresh Token ìš”ì²­");
        await fetch("/refresh-token", {
          method: "POST",
          credentials: "include",
        })
          .then(response => response.json())
          .then(data => {
            if (data.access_token) {
              console.log("[DEBUG] ìƒˆë¡œìš´ Access Token ë°œê¸‰ ì™„ë£Œ");
              document.cookie = `access_token=${data.access_token}; path=/; HttpOnly`;
            } else {
              console.error("[ERROR] Access Token ê°±ì‹  ì‹¤íŒ¨");
            }
          })
          .catch(error =>
            console.error("[ERROR] Refresh Token ìš”ì²­ ì‹¤íŒ¨:", error)
          );
      }
    }

    // âœ… Refresh Token ë§Œë£Œ ì‹œ ìë™ ë¡œê·¸ì•„ì›ƒ
    if (cookies["refresh_token"]) {
      const refreshPayload = JSON.parse(
        atob(cookies["refresh_token"].split(".")[1])
      );
      const refreshExp = refreshPayload.exp * 1000;

      if (refreshExp < now) {
        console.log("[DEBUG] Refresh Token ë§Œë£Œë¨, ìë™ ë¡œê·¸ì•„ì›ƒ ì‹¤í–‰");
        await fetch("/logout", { method: "GET", credentials: "include" }).then(
          () => (window.location.href = "/login")
        );
      }
    }
  }

  // ğŸ”¥ 10ì´ˆë§ˆë‹¤ Access Token & Refresh Token ìƒíƒœ í™•ì¸
  setInterval(checkTokenStatus, 10000);
</script>
